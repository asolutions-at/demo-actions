name: Maven Build and Test

on:
 # push:
 #   branches:
 #     - master
 # pull_request:
 #   branches:
 #     - master
  workflow_dispatch:

jobs:
  build:
    runs-on: swedencentral-sst-uqaat-github-runners
    steps:
#      - name: Check connectivity
#        run: |
#          curl -kv https://codequality.uniqa.at
#          curl -kv https://binaries.sonarsource.com/Distribution/sonar-scanner-cli/sonar-scanner-cli-7.1.0.4889-linux-x64.zip
      - name: Checkout code
        uses: actions/checkout@v4

#      - name: Check connectivity
#        run: |
#             curl -kv https://maven.uniqa.at/artifacts/repo

      - name: Set up JDK 17
        uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'temurin'

     

      - name: Build with Maven
        run: mvn  clean install --settings .m2/settings.xml
        #run: clean source:jar org.jacoco:jacoco-maven-plugin:prepare-agent deploy org.jacoco:jacoco-maven-plugin:report -PjBossBuild --settings ~/.m2/settings.xml

      - name: SonarQube Scan
        uses: sonarSource/sonarqube-scan-action@v5.1.0 # Ex: v4.1.0, See the latest version at https://github.com/marketplace/actions/official-sonarqube-scan
        env:
          SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}
          SONAR_HOST_URL: ${{ vars.SONAR_HOST_URL }}

      - name: SonarQube Quality Gate check
        id: sonarqube-quality-gate-check
        uses: sonarsource/sonarqube-quality-gate-action@master
        with:
          pollingTimeoutSec: 600
        env:
         SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}
         SONAR_HOST_URL: ${{ vars.SONAR_HOST_URL }} #OPTIONAL

